<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
      <meta name="description" content="A python CLI tool for automating task for A10 Load balancer. Enable, Disable servers or virtual services">
      <meta name="twitter:description" content="A python CLI tool for automating task for A10 Load balancer. Enable, Disable servers or virtual services">
    

    <meta property="og:title" content="A10 Network load balancer automation">
    <meta property="twitter:title" content="A10 Network load balancer automation">
    
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2017-06-05">
    
    <meta property="og:description" content="A python CLI tool for automating task for A10 Load balancer. Enable, Disable servers or virtual services">
    <meta property="og:url" content="https://tarunlalwani.com/post/a10-network-load-balancer-automation/">
    <meta property="og:site_name" content="Tech Adventures by Tarun Lalwani">
   

    
    <meta property="og:tags" content="a10">
    
    <meta property="og:tags" content="load balancer">
    
    <meta property="og:tags" content="python">
    
    <meta property="og:tags" content="cli">
    

    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@ask4tarun">
    <meta property="og:image" content="https://tarunlalwani.com/images/a10cli.png">
    <meta property="twitter:image" content="https://tarunlalwani.com/images/a10cli.png">
    

    <meta name="generator" content="Hugo 0.42.1" />
    <title>A10 Network load balancer automation &middot; Tech Adventures by Tarun Lalwani</title>
    
    <link rel="stylesheet" href="https://tarunlalwani.com/css/style.css">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
   <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/sunburst.min.css">

    

    
    <link href="https://tarunlalwani.com/index.xml" rel="alternate" type="application/rss+xml" title="Tech Adventures by Tarun Lalwani" />
    
    

    
    
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="https://tarunlalwani.com/">TARUN LALWANI</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="https://tarunlalwani.com/">TARUN LALWANI</a></h1>
		
		
		
			<small class="text-center center-block">Technology Enthusiast</small>
		
		
		
			<img id="profile-pic" src="https://tarunlalwani.com//images/profile.png" alt="My Picture" class="img-circle center-block">
		
		<div id="social" class="text-center">
			<a href="https://twitter.com/ask4tarun"><i class="fa fa-twitter fa-2x"></i></a>
			<a href="https://plus.google.com/&#43;TarunLalwani"><i class="fa fa-google-plus fa-2x"></i></a>
			<a href="https://www.linkedin.com/in/tarunlalwani"><i class="fa fa-linkedin fa-2x"></i></a>
			<a href="https://github.com/tarunlalwani"><i class="fa fa-github fa-2x"></i></a>
			
		</div>
		<div id="links" class="text-center">
			
			
		</div>
	</div>
</div>

		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>
	<header>
		<h1>A10 Network load balancer automation</h1>
	</header>

	<article>
		

<p><a href="https://www.a10networks.com/">A10 Networks</a> provides hardware Load Balancer, which can be used to balance loads in your data center.</p>

<p>A10 Load Balancer (LB) have a web based interface to perform different task. Once the server definitions tasks are created, the common thing is to disable and enable servers out of LB.</p>

<p>Going to the web interface and performing these activities is a tedious task. Also many time the Linux operations teams want to view the status of these server.</p>

<p>While looking at ways to automate this task, we came across this <a href="https://github.com/fim/a10ctl">a10ctl</a> CLI. But it didn&rsquo;t have all the functionality we needed.</p>

<p>So we decided to enhance it and add new features. Features added
- Enviroment variables for common parameters
- Config file support
- New commands</p>

<p>The details of the CLI is as below. If you use A10 LB in your premise, this could be a lot of help.</p>

<blockquote>
<p>Note: We have included acos_client also as a part of this, as there was patch we had to apply for a infinite loop.</p>
</blockquote>

<h1 id="a10-load-balanacer-cli-a10ctl">A10 Load Balanacer CLI (a10ctl)</h1>

<p><code>a10ctl</code> is a A10 Load balancer CLI tool. It currently has below mentioned functionality:</p>

<ul>
<li>List information about a server</li>
<li>Enable a server</li>
<li>Disable a server</li>
<li>Enable certain ports for a server</li>
<li>Disable certain ports for a server</li>
<li>List or watch connections for a server</li>
<li>Wait for Zero connections to a specific server or port</li>
<li>List all servers configured in LB</li>
<li>List all Service groups configure in LB</li>
</ul>

<h2 id="installing-a10ctl">Installing a10ctl</h2>

<p>You need to have Python installed. For windows make sure to add python to PATH and Scripts directory inside python also to path. Also install using GIT Bash or GIT CMD</p>

<p>Installation is simple. Can be done in two way</p>

<h3 id="install-using-pip">Install using pip</h3>

<pre><code class="language-bash"> pip install a10ctl
</code></pre>

<h3 id="install-using-setup-py">Install using setup.py</h3>

<pre><code class="language-bash"> git clone https://github.com/tarunlalwani/a10ctl
 cd a10ctl
 python setup.py install
</code></pre>

<h2 id="a10-config">A10 Config</h2>

<p>There are 3 ways to configure or provide a10 configuration. These configuration parameters are
- host
- username
- password
- partition</p>

<h4 id="config-file">Config file</h4>

<p>Easiest way to create a config file is to use the <code>a10ctl config</code> command</p>

<pre><code class="language-bash">$ a10ctl config
Where to create the config file?

        0 - ./.a10.conf
        1 - ~/.a10.conf
        2 - /etc/.a10.conf

[0]: 0
Enter profile name [root]: root
Enter host name []: lb
Enter username []: tarun
Enter password (Leave blank to save existing) [****]:
Enter partition [shared]: DMZ_WEB
Configuration saved!
</code></pre>

<p>This will create a <code>.a10.conf</code> file with below contents</p>

<pre><code class="language-ini">[root]
host = lb
username = tarun
password = ..................
partition = DMZ_WEB
</code></pre>

<p>A user can create multiple profiles. The default profile is the <code>root</code> profile. If you choose to create the config file in current directory then <code>a10ctl</code> should always be used in the same directory for it to pick the config file</p>

<p>By default <code>a10ctl</code> looks for <code>.a10.conf</code> in below directories in order (stopping at the first one found):
- ./.a10.conf
- ~/.a10.conf
- /etc/.a10.conf</p>

<p>A custom config file path can be specified to <code>a10ctl</code> using the <code>-c</code> or <code>--config</code> flag. The profile can be specified using <code>-L</code> or <code>--profile</code> flag</p>

<pre><code class="language-sh">$ a10ctl --config ~/mya10.conf --profile root
</code></pre>

<h4 id="environment-variables">Environment variables</h4>

<p><code>a10ctl</code> supports below mentioned environment variables to configure the command line options</p>

<ul>
<li>A10_HOST</li>
<li>A10_USERNAME</li>
<li>A10_PASSWORD</li>
<li>A10_PARTITION</li>
<li>A10_CONFIG</li>
<li>A10_PROFILE</li>
</ul>

<pre><code class="language-bash">$ export A10_HOST=lb
$ export A10_USERNAME=tarun
$ export A10_PASSWORD='xyz....'
$ export A10_PARTITION=DMZ_WEB
$ a10ctl servers
</code></pre>

<h4 id="command-line-parameters">Command line parameters</h4>

<p>All parameters support command line options as well</p>

<ul>
<li>-H or &ndash;host</li>
<li>-u or &ndash;username</li>
<li>-p or &ndash;password</li>
<li>-k or &ndash;ask-password (will ask for username/password if not provided)</li>
<li>-L or &ndash;profile (To provide profile name. root by default)</li>
<li>-P or &ndash;partition (The partition name)</li>
</ul>

<h2 id="commands">Commands</h2>

<p>All these commands assume that you have provided all the command line details about username, password, host, partition through environment variables or config file.</p>

<h4 id="get-list-of-all-server">Get list of all Server</h4>

<pre><code class="language-bash">$ a10ctl servers
</code></pre>

<h4 id="get-information-about-a-server">Get information about a server</h4>

<pre><code class="language-bash">$ a10ctl status 192.168.1.101
</code></pre>

<p>To get additional details on the server there are few flags that can be used
- <code>--groups</code> - List all the Virtual groups this service is part of
- <code>--services</code> - List all the Virtual Service this server is part of
- <code>--vservers</code> - List all the Virtual servers this server is part of
- <code>--all</code> - Get all the details without specifying above flags</p>

<pre><code class="language-bash">$ a10ctl status --all 192.168.1.101
</code></pre>

<h3 id="get-list-of-all-virtual-groups">Get list of all Virtual Groups</h3>

<pre><code class="language-bash">$ a10ctl groups
</code></pre>

<p>If you need to see members of each group use the <code>--members</code> flag</p>

<pre><code class="language-bash">$ a10ctl groups --members
</code></pre>

<h4 id="disable-a-server-in-lb">Disable a server in LB</h4>

<p>Using IP</p>

<pre><code class="language-bash">$ a10ctl disable 192.168.1.101
</code></pre>

<p>Using Name</p>

<pre><code class="language-bash">$ a10ctl disable Name_192.168.1.101
</code></pre>

<p>If you need to wait for zero connections on the server you can pass a additional flag <code>--wait</code>. By default wait would timeout after <code>120</code> secs. You can change the timeout using <code>--timeout</code> flag if you want</p>

<pre><code class="language-bash">$ a10ctl disable --wait --timeout 360 192.168.1.101
</code></pre>

<h4 id="enable-a-server-in-lb">Enable a server in LB</h4>

<pre><code class="language-bash">$ a10ctl enable 192.168.1.101
</code></pre>

<h4 id="disable-certain-ports-of-a-server-in-lb">Disable certain ports of a server in LB</h4>

<pre><code class="language-bash">$ a10ctl disableports 192.168.1.101 80
</code></pre>

<p>Disable multiple ports at the same time</p>

<pre><code class="language-bash">$ a10ctl disableports 192.168.1.101 80 443
</code></pre>

<p>Like the disable command, this command also supports <code>--wait</code> and <code>--timeout</code> flag</p>

<pre><code class="language-bash">$ a10ctl disableports --wait --timeout 360 192.168.1.101 80 443
</code></pre>

<h4 id="enable-certain-ports-in-lb">Enable certain ports in LB</h4>

<pre><code class="language-bash">$ a10ctl enableports 192.168.1.101 80 443
</code></pre>

<h4 id="watch-connections-for-a-server">Watch connections for a server</h4>

<pre><code class="language-bash">$ a10ctl connections 192.168.1.101
</code></pre>

<p>If you are interested only in certain ports, you can use <code>--port</code> or <code>-p</code> flag</p>

<pre><code class="language-bash">$ a10ctl connections 192.168.1.101 --port 80 --port 443
</code></pre>

<p>The connection command displays current status and exits. To continuously watch for connection use <code>--watch</code> or <code>-w</code> flag. The interval to sleep between polling can be controlled using <code>--interval</code> or <code>-i</code> flag. Default interval is 5 secs.</p>

<pre><code class="language-bash">$ a10ctl connections 192.168.1.101 --port 80 --port 443 --watch --interval 10
</code></pre>

<h4 id="wait-for-zero-connections-on-a-server-or-certain-ports-of-server">Wait for zero connections on a server or certain ports of server</h4>

<p>Wait for zero connections on a server</p>

<pre><code class="language-bash">$ a10ctl zeroconnections 192.168.1.101
</code></pre>

<p>Wait for zero connections os ports of server</p>

<pre><code class="language-bash">$ a10ctl zeroconnections 192.168.1.101 --port 80 --port 443
</code></pre>

<p>Default timeout is <code>120</code> secs. The timeout can be changed using <code>--timeout</code> flag</p>

	</article>
</main>

<div id="bottom-nav" class="text-center center-block">
	<a href=" https://tarunlalwani.com/" class="btn btn-default"><i class="fa fa-home"></i> Home</a>
</div>


  <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'tarunlalwani';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



						</div>
					</div>
				</div>
			</div>
		</div>
  </div>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-99088991-1', 'auto');
    ga('send', 'pageview');
    window.baseURL = "https:\/\/tarunlalwani.com\/";
  </script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  
  
  

  <script src="https://tarunlalwani.com//js/highlight.pack.js"></script>
  
  <script src="https://tarunlalwani.com//js/App.js"></script>
  
</body>
</html>
